<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Grid Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .job-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: white;
        }
        .job-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .job-details {
            color: #666;
            margin-bottom: 10px;
        }
        .btn {
            background-color: #1976d2;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Job Grid Test Page</h1>
        <p>This page tests the job API directly to ensure the backend is working.</p>
        
        <div id="status" class="loading">Loading jobs...</div>
        <div id="jobs-container"></div>
    </div>

    <script>
        async function testJobAPI() {
            const statusDiv = document.getElementById('status');
            const jobsContainer = document.getElementById('jobs-container');
            
            try {
                statusDiv.innerHTML = 'Fetching jobs from API...';
                
                const response = await fetch('http://localhost:5000/api/public/jobs?limit=10');
                const data = await response.json();
                
                console.log('API Response:', data);
                
                if (data.success && data.jobs && data.jobs.length > 0) {
                    statusDiv.innerHTML = `Found ${data.jobs.length} jobs (Total: ${data.totalCount || data.jobs.length})`;
                    
                    jobsContainer.innerHTML = data.jobs.map(job => `
                        <div class="job-card">
                            <div class="job-title">${job.title}</div>
                            <div class="job-details">
                                <strong>Company:</strong> ${job.employerId?.companyName || job.companyName || 'Not specified'}<br>
                                <strong>Location:</strong> ${job.location || 'Not specified'}<br>
                                <strong>Type:</strong> ${job.jobType || 'Not specified'}<br>
                                <strong>Category:</strong> ${job.category || 'Not specified'}<br>
                                <strong>CTC:</strong> ${job.ctc ? `â‚¹${Math.floor(job.ctc.min/100000)}-${Math.floor(job.ctc.max/100000)} LPA` : 'Not specified'}<br>
                                <strong>Vacancies:</strong> ${job.vacancies || 'Not specified'}
                            </div>
                            <button class="btn" onclick="alert('Job ID: ${job._id}')">View Details</button>
                        </div>
                    `).join('');
                } else {
                    statusDiv.innerHTML = 'No jobs found in the database.';
                    statusDiv.className = 'error';
                    jobsContainer.innerHTML = `
                        <div class="job-card">
                            <p>The API returned successfully but no jobs were found.</p>
                            <p>You may need to:</p>
                            <ul>
                                <li>Run the sample data script: <code>node backend/scripts/addJobGridSampleData.js</code></li>
                                <li>Check if the database is connected</li>
                                <li>Verify the backend server is running on port 5000</li>
                            </ul>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error fetching jobs:', error);
                statusDiv.innerHTML = 'Error connecting to the API. Make sure the backend server is running on http://localhost:5000';
                statusDiv.className = 'error';
                jobsContainer.innerHTML = `
                    <div class="job-card">
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Please ensure:</p>
                        <ul>
                            <li>Backend server is running: <code>npm start</code> in the backend directory</li>
                            <li>Server is accessible at http://localhost:5000</li>
                            <li>CORS is properly configured</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // Test the API when page loads
        testJobAPI();
    </script>
</body>
</html>