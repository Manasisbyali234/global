import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport axios from 'axios';\n\nexport default function ViewAnswersDiagnostic() {\n  const { attemptId } = useParams();\n  const [diagnostics, setDiagnostics] = useState({\n    attemptId: null,\n    token: null,\n    apiUrl: null,\n    response: null,\n    error: null,\n    timestamp: null\n  });\n\n  useEffect(() => {\n    runDiagnostics();\n  }, [attemptId]);\n\n  const runDiagnostics = async () => {\n    const token = localStorage.getItem('employerToken');\n    const apiUrl = `http://localhost:5000/api/employer/assessment-attempts/${attemptId}`;\n    \n    setDiagnostics(prev => ({\n      ...prev,\n      attemptId,\n      token: token ? 'Token exists' : 'No token found',\n      apiUrl,\n      timestamp: new Date().toISOString()\n    }));\n\n    try {\n      console.log('üîç Running diagnostics...');\n      console.log('Attempt ID:', attemptId);\n      console.log('Token exists:', !!token);\n      console.log('API URL:', apiUrl);\n      \n      const response = await axios.get(apiUrl, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      \n      console.log('‚úÖ API Response received:', response.status);\n      console.log('Response data:', response.data);\n      \n      setDiagnostics(prev => ({\n        ...prev,\n        response: {\n          status: response.status,\n          success: response.data.success,\n          hasAttempt: !!response.data.attempt,\n          hasAssessment: !!response.data.attempt?.assessmentId,\n          answersCount: response.data.attempt?.answers?.length || 0,\n          candidateName: response.data.attempt?.candidateId?.name || 'N/A',\n          assessmentTitle: response.data.attempt?.assessmentId?.title || 'N/A',\n          fullResponse: response.data\n        }\n      }));\n      \n    } catch (error) {\n      console.error('‚ùå API Error:', error);\n      \n      setDiagnostics(prev => ({\n        ...prev,\n        error: {\n          message: error.message,\n          status: error.response?.status,\n          statusText: error.response?.statusText,\n          data: error.response?.data,\n          isNetworkError: !error.response,\n          isAuthError: error.response?.status === 401 || error.response?.status === 403,\n          isNotFound: error.response?.status === 404\n        }\n      }));\n    }\n  };\n\n  return (\n    <div style={{ padding: '2rem', fontFamily: 'monospace', fontSize: '14px' }}>\n      <h2>View Answers Diagnostic</h2>\n      \n      <div style={{ background: '#f5f5f5', padding: '1rem', borderRadius: '8px', marginBottom: '1rem' }}>\n        <h3>Basic Info</h3>\n        <p><strong>Attempt ID:</strong> {diagnostics.attemptId}</p>\n        <p><strong>Token Status:</strong> {diagnostics.token}</p>\n        <p><strong>API URL:</strong> {diagnostics.apiUrl}</p>\n        <p><strong>Timestamp:</strong> {diagnostics.timestamp}</p>\n      </div>\n\n      {diagnostics.response && (\n        <div style={{ background: '#e8f5e8', padding: '1rem', borderRadius: '8px', marginBottom: '1rem' }}>\n          <h3>‚úÖ API Response</h3>\n          <p><strong>Status:</strong> {diagnostics.response.status}</p>\n          <p><strong>Success:</strong> {diagnostics.response.success ? 'Yes' : 'No'}</p>\n          <p><strong>Has Attempt:</strong> {diagnostics.response.hasAttempt ? 'Yes' : 'No'}</p>\n          <p><strong>Has Assessment:</strong> {diagnostics.response.hasAssessment ? 'Yes' : 'No'}</p>\n          <p><strong>Answers Count:</strong> {diagnostics.response.answersCount}</p>\n          <p><strong>Candidate Name:</strong> {diagnostics.response.candidateName}</p>\n          <p><strong>Assessment Title:</strong> {diagnostics.response.assessmentTitle}</p>\n          \n          <details style={{ marginTop: '1rem' }}>\n            <summary>Full Response Data</summary>\n            <pre style={{ background: 'white', padding: '1rem', borderRadius: '4px', overflow: 'auto', maxHeight: '400px' }}>\n              {JSON.stringify(diagnostics.response.fullResponse, null, 2)}\n            </pre>\n          </details>\n        </div>\n      )}\n\n      {diagnostics.error && (\n        <div style={{ background: '#ffe8e8', padding: '1rem', borderRadius: '8px', marginBottom: '1rem' }}>\n          <h3>‚ùå API Error</h3>\n          <p><strong>Message:</strong> {diagnostics.error.message}</p>\n          <p><strong>Status:</strong> {diagnostics.error.status || 'N/A'}</p>\n          <p><strong>Status Text:</strong> {diagnostics.error.statusText || 'N/A'}</p>\n          <p><strong>Network Error:</strong> {diagnostics.error.isNetworkError ? 'Yes' : 'No'}</p>\n          <p><strong>Auth Error:</strong> {diagnostics.error.isAuthError ? 'Yes' : 'No'}</p>\n          <p><strong>Not Found:</strong> {diagnostics.error.isNotFound ? 'Yes' : 'No'}</p>\n          \n          {diagnostics.error.data && (\n            <details style={{ marginTop: '1rem' }}>\n              <summary>Error Response Data</summary>\n              <pre style={{ background: 'white', padding: '1rem', borderRadius: '4px', overflow: 'auto' }}>\n                {JSON.stringify(diagnostics.error.data, null, 2)}\n              </pre>\n            </details>\n          )}\n        </div>\n      )}\n\n      <div style={{ background: '#fff3cd', padding: '1rem', borderRadius: '8px' }}>\n        <h3>üîß Troubleshooting Steps</h3>\n        <ol>\n          <li>Check if the backend server is running on port 5000</li>\n          <li>Verify you're logged in as an employer (check localStorage for 'employerToken')</li>\n          <li>Confirm the attempt ID exists in the database</li>\n          <li>Check if the attempt belongs to the logged-in employer</li>\n          <li>Verify the assessment has answers submitted by the candidate</li>\n        </ol>\n        \n        <button \n          onClick={runDiagnostics}\n          style={{\n            background: '#007bff',\n            color: 'white',\n            border: 'none',\n            padding: '0.5rem 1rem',\n            borderRadius: '4px',\n            cursor: 'pointer',\n            marginTop: '1rem'\n          }}\n        >\n          Run Diagnostics Again\n        </button>\n      </div>\n    </div>\n  );\n}\n