<!DOCTYPE html>
<html>
<head>
    <title>Test Pincode Service</title>
</head>
<body>
    <h1>Test Pincode Service</h1>
    <input type="text" id="pincode" placeholder="Enter 6-digit pincode" maxlength="6">
    <button onclick="testPincode()">Test</button>
    <div id="result"></div>

    <script>
        async function fetchLocationFromPincode(pincode) {
            try {
                if (!pincode || !/^\d{6}$/.test(pincode)) {
                    throw new Error('Invalid pincode format');
                }

                const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
                const data = await response.json();

                if (data && data.length > 0 && data[0].Status === 'Success') {
                    const postOffice = data[0].PostOffice[0];
                    return {
                        success: true,
                        location: postOffice.Name,
                        district: postOffice.District,
                        state: postOffice.State,
                        stateCode: getStateCode(postOffice.State),
                        country: postOffice.Country
                    };
                } else {
                    return {
                        success: false,
                        message: 'Invalid pincode or location not found'
                    };
                }
            } catch (error) {
                console.error('Error fetching location from pincode:', error);
                return {
                    success: false,
                    message: 'Failed to fetch location data'
                };
            }
        }

        const getStateCode = (stateName) => {
            const stateCodeMap = {
                'Andhra Pradesh': 'AP',
                'Arunachal Pradesh': 'AR',
                'Assam': 'AS',
                'Bihar': 'BR',
                'Chhattisgarh': 'CG',
                'Goa': 'GA',
                'Gujarat': 'GJ',
                'Haryana': 'HR',
                'Himachal Pradesh': 'HP',
                'Jharkhand': 'JH',
                'Karnataka': 'KA',
                'Kerala': 'KL',
                'Madhya Pradesh': 'MP',
                'Maharashtra': 'MH',
                'Manipur': 'MN',
                'Meghalaya': 'ML',
                'Mizoram': 'MZ',
                'Nagaland': 'NL',
                'Odisha': 'OD',
                'Punjab': 'PB',
                'Rajasthan': 'RJ',
                'Sikkim': 'SK',
                'Tamil Nadu': 'TN',
                'Telangana': 'TS',
                'Tripura': 'TR',
                'Uttar Pradesh': 'UP',
                'Uttarakhand': 'UK',
                'West Bengal': 'WB',
                'Andaman and Nicobar Islands': 'AN',
                'Chandigarh': 'CH',
                'Dadra and Nagar Haveli and Daman and Diu': 'DH',
                'Delhi': 'DL',
                'Jammu and Kashmir': 'JK',
                'Ladakh': 'LA',
                'Lakshadweep': 'LD',
                'Puducherry': 'PY'
            };
            return stateCodeMap[stateName] || '';
        };

        async function testPincode() {
            const pincode = document.getElementById('pincode').value;
            const resultDiv = document.getElementById('result');
            
            if (!pincode) {
                resultDiv.innerHTML = '<p style="color: red;">Please enter a pincode</p>';
                return;
            }

            resultDiv.innerHTML = '<p>Fetching location...</p>';
            
            try {
                const result = await fetchLocationFromPincode(pincode);
                console.log('Result:', result);
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div style="color: green;">
                            <h3>Location Found:</h3>
                            <p><strong>Location:</strong> ${result.location}</p>
                            <p><strong>District:</strong> ${result.district}</p>
                            <p><strong>State:</strong> ${result.state}</p>
                            <p><strong>State Code:</strong> ${result.stateCode}</p>
                            <p><strong>Country:</strong> ${result.country}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">Error: ${result.message}</p>`;
                }
            } catch (error) {
                console.error('Test error:', error);
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        // Test with a sample pincode on load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('pincode').value = '110001';
        });
    </script>
</body>
</html>